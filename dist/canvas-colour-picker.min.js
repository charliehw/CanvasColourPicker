/*! 
	canvas-colour-picker 2013-10-03 
	Author: charliehw
	License: MIT
*/
var ccp=ccp||{};ccp.ColourPicker=function(a){this.canvas=new ccp.Canvas(a.canvas),this.colour=new ccp.Colour,this.onchange=a.onchange,this.spectrum=new ccp.Spectrum(this),this.gradient=new ccp.Gradient(this),this.bind()},ccp.ColourPicker.prototype={constructor:ccp.ColourPicker,getColour:function(){return this.colour},updateGradient:function(){this.gradient.setBaseColour(),this.setColour(this.gradient.sampleColour())},setColour:function(a){this.colour.setData(a),"function"==typeof this.onchange&&this.onchange(this.getColour())},render:function(){this.canvas.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.spectrum.render(),this.gradient.render()},bind:function(){var a,b=this;ccp.utils.Handler.bind(this.canvas.elem,"mousedown",function(c){b.update(this,c),a=ccp.utils.Handler.bind(b.canvas.elem,"mousemove",function(a){b.update(this,a)})}),ccp.utils.Handler.bind(this.canvas.elem,"mouseup mouseout",function(){ccp.utils.Handler.unbind(a||[])})},update:function(a,b){var c=ccp.utils.offset(a),d={x:b.pageX-c.left,y:b.pageY-c.top};d.x<this.canvas.height?this.gradient.update.call(this.gradient,d):d.x>this.canvas.height+10&&this.spectrum.update.call(this.spectrum,d)}},ccp.Colour=function(a){a&&this.setData(a)},ccp.Colour.prototype={constructor:ccp.Colour,setData:function(a){this.data=a},rgbToCMYK:function(a,b,c){var d,e,f,g,h;return 0===a&&0===b&&0===c?[0,0,0,1]:(d=1-a/255,e=1-b/255,f=1-c/255,g=h=Math.min(d,Math.min(e,f)),d=(d-h)/(1-h),e=(e-h)/(1-h),f=(f-h)/(1-h),[Math.round(100*d)/100,Math.round(100*e)/100,Math.round(100*f)/100,Math.round(100*g)/100])},getRGB:function(a){return this.data?a?{r:this.data[0],g:this.data[1],b:this.data[2]}:"rgb("+this.data[0]+","+this.data[1]+","+this.data[2]+")":null},getCMYK:function(a){var b=[];return this.data?(b=this.rgbToCMYK(this.data[0],this.data[1],this.data[2]),a?b:"cmyk("+b[0]+","+b[1]+","+b[2]+","+b[3]+")"):null},getHex:function(a){var b,c,d=[];for(c=0;3>c;c++)b=this.data[c].toString(16),d.push(1===b.length?"0"+b:b);return a?d:"#"+d.join("")}},ccp.Gradient=function(a){this.colourPicker=a,this.pointer=new ccp.Pointer(this),this.setBaseColour(),this.render(),this.colourPicker.setColour(this.sampleColour())},ccp.Gradient.prototype={constructor:ccp.Gradient,render:function(){var a,b=this.colourPicker.canvas.context;b.fillStyle=this.baseColour,b.fillRect(0,0,this.colourPicker.canvas.height,this.colourPicker.canvas.height),a=b.createLinearGradient(0,0,0,this.colourPicker.canvas.height),a.addColorStop(0,"rgba(0, 0, 0, 0)"),a.addColorStop(1,"rgba(0, 0, 0, 1)"),b.fillStyle=a,b.fillRect(0,0,this.colourPicker.canvas.height,this.colourPicker.canvas.height),a=b.createLinearGradient(0,0,this.colourPicker.canvas.height,0),a.addColorStop(0,"rgba(0, 0, 0, 0.9)"),a.addColorStop(1,"rgba(0, 0, 0, 0)"),b.fillStyle=a,b.fillRect(0,0,this.colourPicker.canvas.height,this.colourPicker.canvas.height),a=b.createRadialGradient(0,0,5,0,0,this.colourPicker.canvas.height),a.addColorStop(0,"rgba(255, 255, 255, 1)"),a.addColorStop(1,"rgba(255, 255, 255, 0)"),b.fillStyle=a,b.fillRect(0,0,this.colourPicker.canvas.height,this.colourPicker.canvas.height),this.pointer.render()},sampleColour:function(a){var b=a||this.pointer.position;return this.colourPicker.canvas.context.getImageData(b.x,b.y,1,1).data},setBaseColour:function(){var a=new ccp.Colour(this.colourPicker.spectrum.sampleColour());this.baseColour=a.getRGB()},update:function(a){this.pointer.update(a),this.colourPicker.render(),this.colourPicker.setColour(this.sampleColour(a))}},ccp.Spectrum=function(a){this.colourPicker=a,this.pointer=new ccp.Pointer(this),this.render()},ccp.Spectrum.prototype={constructor:ccp.Spectrum,render:function(){var a=this.colourPicker.canvas.context.createLinearGradient(0,0,0,this.colourPicker.canvas.height);a.addColorStop(0,"rgb(255,   0,   0)"),a.addColorStop(.15,"rgb(255,   0, 255)"),a.addColorStop(.33,"rgb(0,     0, 255)"),a.addColorStop(.49,"rgb(0,   255, 255)"),a.addColorStop(.67,"rgb(0,   255,   0)"),a.addColorStop(.84,"rgb(255, 255,   0)"),a.addColorStop(1,"rgb(255,   0,   0)"),this.colourPicker.canvas.context.fillStyle=a,this.colourPicker.canvas.context.fillRect(this.colourPicker.canvas.height+10,0,this.colourPicker.canvas.width-this.colourPicker.canvas.height-15,this.colourPicker.canvas.height),this.pointer.render()},sampleColour:function(a){var b=a||this.pointer.position;return this.colourPicker.canvas.context.getImageData(this.colourPicker.canvas.height+10,b.y,1,1).data},update:function(a){this.pointer.update({x:0,y:a.y}),this.colourPicker.updateGradient(),this.colourPicker.render()}},ccp.Pointer=function(a){this.colourPicker=a.colourPicker,this.canvas=this.colourPicker.canvas,this.getDefaultPosition(),this.type=a.constructor===ccp.Spectrum?"arrow":"radial"},ccp.Pointer.prototype={constructor:ccp.Pointer,render:function(){"arrow"===this.type?this.renderArrow():this.renderRadial()},renderArrow:function(){var a=this.canvas.context;a.beginPath(),a.moveTo(this.canvas.width-5,this.position.y),a.lineTo(this.canvas.width,this.position.y-3),a.lineTo(this.canvas.width,this.position.y+3),a.lineTo(this.canvas.width-5,this.position.y),a.closePath(),a.fillStyle="rgb(0, 0, 0)",a.fill()},renderRadial:function(){var a=this.canvas.context;a.lineWidth=1,a.beginPath(),a.arc(this.position.x,this.position.y,4,0,2*Math.PI,!1),a.closePath(),a.strokeStyle="black",a.stroke(),a.beginPath(),a.arc(this.position.x,this.position.y,3,0,2*Math.PI,!1),a.closePath(),a.strokeStyle="white",a.stroke()},getDefaultPosition:function(){this.position="arrow"===this.type?{x:0,y:0}:{x:0,y:0}},update:function(a){this.position=a}},ccp.Canvas=function(a){a?this.elem=document.querySelector(a):(this.elem=document.createElement("canvas"),this.elem.id="canvas-colour-picker",this.elem.width=350,this.elem.height=300,document.body.appendChild(this.elem)),this.context=this.elem.getContext("2d"),this.height=this.elem.height,this.width=this.elem.width},ccp.utils={},ccp.utils.Handler=function(){var a=1,b={};return{bind:function(c,d,e){var f,g,h=d.split(" "),i=[];for(f=0,g=h.length;g>f;f++)c.addEventListener(h[f],e),b[a]={element:c,event:h[f],handler:e},i.push(a++);return i},unbind:function(){var a,c,d,e,f=0,g=0;for(c=arguments.length;c>f;f++)for(a=arguments[f],d=a.length;d>g;g++)a[g]in b&&(e=b[a[g]],e.element.removeEventListener(e.event,e.handler))}}}(),ccp.utils.extend=function(a,b){a=a||{},b=b||{};for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},ccp.utils.offset=function(a){var b={left:a.offsetLeft,top:a.offsetTop};do a=a.offsetParent,b.left+=a.offsetLeft,b.top+=a.offsetTop;while(a.offsetParent);return b},ccp.utils.toggleClass=function(a,b){var c=a.className.split(" ");c.indexOf(b)>-1?c.splice(c.indexOf(b),1):c.push(b),a.className=c.join(" ")};